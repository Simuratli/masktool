import React, { useEffect, useState } from 'react'
import { ProgressItem, ProgressSettings, ProgressTutorial, ProgressDividedProgresbar } from './ProgressItem'
import { useSelector } from 'react-redux'
import { ReducerType } from '../../redux/reducers/reducer.types'
import InfoIcon from "./ProgressItem/icons/info";

function Progress() {
  const stepState = useSelector((state: ReducerType) => state.stepReducer.step)
  const notificationState = useSelector((state: ReducerType) => state.notificationReducer.agree)
  const [disabledContainer, setdisabledContainer] = useState<string[]>([])


  useEffect(() => {
    setdisabledContainer([])
  }, [notificationState])



  useEffect(() => {
    setdisabledContainer((prev: string[]) => ([...prev, stepState]))
  }, [stepState])


  return (
    <div className='progress'>
      <ProgressItem
        disabled={false}
        id='notifications'
        icon={<span className='progress__item__icon'><svg width="15" height="17" viewBox="0 0 15 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.6631 11.1966L11.2626 6.912C11.1253 5.43898 10.3038 4.45898 9.2545 3.97008C8.72535 3.72364 8.13654 3.5999 7.54725 3.5999C6.95798 3.5999 6.36917 3.72306 5.83999 3.97008C4.79071 4.45886 3.96908 5.43898 3.83184 6.912L3.42842 11.2284C3.41069 11.4244 3.24609 11.5719 3.05319 11.5713V11.5728H2.62654C2.3882 11.5728 2.17112 11.6707 2.01353 11.8283C1.85597 11.9858 1.75805 12.2029 1.75805 12.4413C1.75805 12.6796 1.85597 12.8967 2.01353 13.0549C2.17109 13.2124 2.38819 13.3104 2.62654 13.3104H12.468C12.7064 13.3104 12.9234 13.2124 13.081 13.0549C13.2386 12.8973 13.3365 12.6802 13.3365 12.4413C13.3365 12.203 13.2386 11.9859 13.081 11.8283C12.9235 11.6707 12.7064 11.5728 12.468 11.5728H12.0414C11.8333 11.5728 11.6647 11.4047 11.6632 11.1971L11.6631 11.1966ZM7.54685 0.5C7.97504 0.5 8.36238 0.673647 8.64263 0.953917C8.92336 1.23464 9.09655 1.62199 9.09655 2.04969C9.09655 2.40674 8.97585 2.73595 8.77284 2.99801C9.04757 3.06916 9.3162 3.16462 9.57322 3.28437C10.8488 3.87823 11.8471 5.06536 12.0126 6.84399L12.3838 10.816H12.4671C12.9146 10.816 13.321 10.9988 13.6154 11.2931C13.9097 11.5875 14.0925 11.9941 14.0925 12.4414C14.0925 12.8889 13.9097 13.2953 13.6154 13.5897C13.321 13.884 12.9145 14.0668 12.4671 14.0668H10.2115C10.1276 14.6571 9.85089 15.1868 9.44796 15.5897C8.96013 16.0775 8.28701 16.38 7.54627 16.38C6.80552 16.38 6.13243 16.077 5.64458 15.5897C5.24164 15.1868 4.9649 14.6565 4.88108 14.0668H2.62541C2.17795 14.0668 1.7715 13.884 1.47715 13.5897C1.18281 13.2953 1 12.8887 1 12.4414C1 11.9939 1.18281 11.5875 1.47715 11.2931C1.7715 10.9988 2.17807 10.816 2.62541 10.816H2.70877L3.07991 6.84399C3.24604 5.06548 4.24436 3.87836 5.51931 3.28437C5.77632 3.16473 6.04494 3.06928 6.31969 2.99801C6.11669 2.73596 5.99598 2.40722 5.99598 2.04969C5.99598 1.62199 6.16963 1.23417 6.4499 0.953917C6.73062 0.673662 7.11797 0.5 7.54568 0.5H7.54685ZM8.10783 1.48872C7.96448 1.34536 7.76594 1.25648 7.54685 1.25648C7.32765 1.25648 7.12922 1.34536 6.98588 1.48872C6.84254 1.63207 6.75364 1.83061 6.75364 2.04969C6.75364 2.2689 6.84252 2.46733 6.98588 2.61067C7.12923 2.75401 7.32777 2.84291 7.54685 2.84291C7.76606 2.84291 7.96449 2.75403 8.10783 2.61067C8.25117 2.46732 8.34007 2.26878 8.34007 2.04969C8.34007 1.83049 8.25119 1.63206 8.10783 1.48872ZM8.91326 15.0545C9.17884 14.7889 9.36823 14.4475 9.44443 14.0663H5.64856C5.72476 14.447 5.91414 14.7889 6.17972 15.0545C6.53067 15.4055 7.0144 15.6231 7.54613 15.6231C8.07787 15.6231 8.5616 15.4055 8.91254 15.0545H8.91326Z" fill="#1A4F95" stroke="#1A4F95" stroke-width="0.5" /></svg></span>}
        text="notifications"
      />
      <ProgressItem
        disabled={!disabledContainer.includes('rules')}
        id='rules'
        icon={<span className='progress__item__icon'><svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.0149 0.5C12.0856 0.49964 11.195 0.871483 10.5419 1.5325C9.97843 1.03298 9.2517 0.757134 8.49865 0.757134C7.74578 0.757134 7.01882 1.033 6.45541 1.5325C5.69263 0.76308 4.6151 0.392639 3.54047 0.530056C2.46565 0.66763 1.51613 1.29749 0.971762 2.23424C0.427256 3.17095 0.349628 4.30772 0.762161 5.30984C1.17452 6.31173 2.02966 7.0646 3.07585 7.34681C4.12186 7.6288 5.23973 7.40785 6.09996 6.74896C6.96014 6.09009 7.46468 5.06856 7.46487 3.98508V3.85867V3.85849C7.46487 3.48953 7.66168 3.14868 7.98111 2.96429C8.30056 2.7799 8.6942 2.7799 9.01361 2.96429C9.33305 3.14868 9.52986 3.48957 9.52986 3.85849V3.9849V3.98508C9.52806 5.16615 10.1253 6.26784 11.1165 6.91049C12.1076 7.55314 13.357 7.64911 14.4348 7.16547V12.8913C14.4348 13.1652 14.326 13.4277 14.1322 13.6215C13.9387 13.815 13.6759 13.9238 13.402 13.9238C13.1283 13.9238 12.8656 14.0326 12.672 14.2263C12.4783 14.4199 12.3695 14.6826 12.3695 14.9565C12.3695 15.2302 12.4783 15.4929 12.672 15.6865C12.8656 15.8803 13.1283 15.989 13.402 15.989C14.2237 15.989 15.0117 15.6627 15.5926 15.0816C16.1735 14.5007 16.5 13.7128 16.5 12.8912V4.11424V3.98513V3.98531C16.4986 3.06137 16.131 2.17579 15.4777 1.52249C14.8244 0.869193 13.9389 0.501655 13.0149 0.500226L13.0149 0.5ZM3.97978 5.4048C3.60325 5.4048 3.24203 5.25534 2.97591 4.98902C2.70959 4.7227 2.55995 4.36168 2.55995 3.98515C2.55995 3.60844 2.70959 3.2474 2.97591 2.9811C3.24205 2.71495 3.60325 2.56532 3.97978 2.56532C4.35631 2.56532 4.71753 2.71495 4.98365 2.9811C5.24997 3.24742 5.39961 3.60844 5.39961 3.98515C5.39889 4.3615 5.24907 4.72216 4.98292 4.98833C4.71678 5.25447 4.35609 5.40429 3.97975 5.40483L3.97978 5.4048ZM13.0149 5.4048C12.6384 5.4048 12.2772 5.25534 12.0111 4.98902C11.7447 4.7227 11.5951 4.36168 11.5951 3.98515C11.5951 3.60844 11.7447 3.2474 12.0111 2.9811C12.2772 2.71495 12.6384 2.56532 13.0149 2.56532C13.3915 2.56532 13.7527 2.71495 14.0188 2.9811C14.2851 3.24742 14.4348 3.60844 14.4348 3.98515C14.434 4.3615 14.2842 4.72216 14.0181 4.98833C13.7519 5.25447 13.3912 5.40429 13.0149 5.40483L13.0149 5.4048Z" fill="#E8EBFE" stroke="white" strokeWidth="0.5" /><path d="M8.41754 10.8259L8.49749 10.72L8.57744 10.8259C8.88536 11.2521 9.2979 11.5917 9.77524 11.812C10.701 12.2229 11.7724 12.1314 12.615 11.5694C12.8026 11.4441 12.9052 11.2251 12.8815 11.0006C12.8577 10.7762 12.7111 10.5837 12.5013 10.5007C12.0632 10.3163 11.6811 10.0197 11.3939 9.64106L10.8595 9.0292C10.2436 8.38222 9.38936 8.01611 8.49622 8.01611C7.60289 8.01611 6.74884 8.38219 6.13279 9.0292L5.59833 9.64106H5.59851C5.31112 10.0197 4.92917 10.3163 4.49111 10.5007C4.27592 10.5796 4.12376 10.7731 4.09747 11.0008C4.07136 11.2284 4.17562 11.4513 4.36704 11.5772C5.20957 12.1391 6.28115 12.2306 7.20675 11.8197C7.68986 11.5993 8.10709 11.2568 8.41756 10.8259H8.41754Z" fill="#E8EBFE" strokeWidth="0.5" /></svg></span>}
        text="masking settings"
      />
      {
        stepState === "progress" ?
          <ProgressDividedProgresbar />
          :
          <ProgressItem
            disabled={true}
            id='progress'
            icon={<span className='progress__item__icon'><svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M8.05127 3.38674V5.09117C8.05127 5.43079 8.32715 5.70666 8.66691 5.70666C9.00667 5.70666 9.2824 5.43079 9.2824 5.09117V3.38674C9.2824 3.04698 9.00667 2.77124 8.66691 2.77124C8.32715 2.77124 8.05127 3.04698 8.05127 3.38674Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M11.8473 4.44901L10.642 5.65433C10.4019 5.89448 10.4019 6.28453 10.6421 6.52482C10.8824 6.76497 11.2725 6.76511 11.5126 6.52482L12.7178 5.31964C12.9581 5.07949 12.958 4.6893 12.7178 4.44916C12.4775 4.20887 12.0875 4.20887 11.8473 4.44902L11.8473 4.44901Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M13.4963 7.88452H12.0758C11.736 7.88452 11.4604 8.1604 11.4604 8.50016C11.4604 8.83992 11.736 9.11565 12.0758 9.11565H13.4963C13.836 9.11565 14.1116 8.83992 14.1116 8.50016C14.1116 8.1604 13.836 7.88452 13.4963 7.88452Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M12.517 11.4793L11.5125 10.475C11.2724 10.2347 10.8823 10.2348 10.6422 10.475C10.4019 10.7153 10.4018 11.1053 10.6421 11.3455L11.6464 12.3499C11.8867 12.5901 12.2766 12.5899 12.5169 12.3498C12.7572 12.1095 12.7573 11.7196 12.517 11.4793V11.4793Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M9.2824 13.0452V11.9088C9.2824 11.5691 9.00653 11.2933 8.66677 11.2933C8.327 11.2933 8.05127 11.5691 8.05127 11.9088V13.0452C8.05127 13.3849 8.327 13.6607 8.66677 13.6607C9.00653 13.6607 9.2824 13.3849 9.2824 13.0452Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M5.88813 12.149L6.69158 11.3456C6.93187 11.1053 6.93187 10.7153 6.69158 10.475C6.45129 10.2348 6.06124 10.2347 5.82109 10.475L5.0175 11.2784C4.77735 11.5187 4.77735 11.9088 5.01764 12.149C5.25779 12.3892 5.64783 12.3893 5.88812 12.149H5.88813Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M4.40602 9.11553H5.25822C5.59784 9.11553 5.87372 8.83966 5.87372 8.4999C5.87372 8.16013 5.59784 7.8844 5.25822 7.8844H4.40602C4.06626 7.8844 3.79053 8.16013 3.79053 8.4999C3.79053 8.83966 4.06626 9.11553 4.40602 9.11553Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M5.21818 5.92199L5.82091 6.52472C6.06106 6.76487 6.45111 6.76487 6.6914 6.52458C6.93155 6.28429 6.93169 5.89424 6.6914 5.65409L6.08881 5.0515C5.84866 4.81121 5.45861 4.81135 5.21832 5.0515C4.97803 5.29179 4.97803 5.68184 5.21818 5.92199L5.21818 5.92199Z" fill="#E8EBFE" /><path fillRule="evenodd" clipRule="evenodd" d="M13.4544 13.2871C10.8121 15.9292 6.52176 15.9292 3.87969 13.2871C1.23746 10.645 1.23746 6.35454 3.87969 3.71248C6.52179 1.07038 10.8123 1.07038 13.4544 3.71248C15.5372 5.79529 15.9785 8.90234 14.7775 11.4188C14.6309 11.7256 14.7613 12.093 15.0676 12.2396C15.3742 12.3858 15.7421 12.2554 15.8883 11.9489C17.3074 8.97513 16.7864 5.30329 14.325 2.84201C11.2023 -0.280669 6.1315 -0.280669 3.009 2.84201C-0.113677 5.96468 -0.113677 11.0351 3.009 14.158C6.13154 17.2807 11.2021 17.2807 14.325 14.158C14.5651 13.9177 14.5651 13.5277 14.325 13.2874C14.0847 13.0471 13.6945 13.0471 13.4544 13.2874L13.4544 13.2871Z" fill="#E8EBFE" /></svg></span>}
            text="masking progress"
          />
      }

      <div className='flex'>
        <ProgressSettings/>
        <ProgressTutorial />
      </div>

    </div>
  )
}

export default React.memo(Progress)